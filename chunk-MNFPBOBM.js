import{L as A,O as C,P as m,c as l,d as O,e as x,p as h,q as P,r as I,u as s,v as y}from"./chunk-6M77AWLU.js";import{$ as S,U as d,Y as j,aa as n,cc as H,dc as U,ec as $,k as E,n as g,x as t}from"./chunk-FRFO45AX.js";import{a as i,b as p}from"./chunk-FOQH46ZT.js";var a=O({source:"Hojavida",events:{"Load Persona":l(),"Load Persona Success":l(),"Load Persona Failure":l(),"Clear Persona":x(),"Update Persona In State":l()}});var L="hojavida",F={persona:null,loadingPersona:!1,errorPersona:null},k=y(F,s(a.loadPersona,o=>p(i({},o),{loadingPersona:!0,errorPersona:null})),s(a.loadPersonaSuccess,(o,{persona:e})=>p(i({},o),{persona:e,loadingPersona:!1})),s(a.loadPersonaFailure,(o,{error:e})=>p(i({},o),{loadingPersona:!1,errorPersona:e})),s(a.clearPersona,()=>F),s(a.updatePersonaInState,(o,{persona:e})=>p(i({},o),{persona:e}))),v=I({name:L,reducer:k}),V=P(v.selectHojavidaState,o=>o.persona?.id),N=P(v.selectHojavidaState,o=>o.persona?.idHojaVida),{name:K,reducer:M,selectHojavidaState:Y,selectPersona:T,selectLoadingPersona:J,selectErrorPersona:_}=v;var u=class o{constructor(e){this.http=e}apiUrl=`${A.hojaDeVidaApiUrl}/persona`;httpOptions={headers:new H({"Content-Type":"application/json"})};auth=n(m);store=n(h);obtenerInformacionPersonal(e){return this.http.get(`${this.apiUrl}/find-by-id-persona/${e}`).pipe(t(this.handleError))}obtenerTodasLasPersonas(){return this.http.get(this.apiUrl).pipe(t(this.handleError))}crearInformacionPersonal(e){return this.http.post(`${this.apiUrl}/create-persona`,e,this.httpOptions).pipe(d(r=>{this.auth.updatePersonaId(r.id).then(()=>this.auth.getSession()),this.store.dispatch(a.loadPersonaSuccess({persona:r}))}),t(this.handleError))}actualizarInformacionPersonal(e){return this.http.put(`${this.apiUrl}/actualizar-persona`,e,this.httpOptions).pipe(t(this.handleError))}eliminarInformacionPersonal(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(t(this.handleError))}buscarPorDocumento(e){return this.http.get(`${this.apiUrl}/find?numero-documento=${e}`).pipe(t(this.handleError))}validarDocumentoExistente(e){return this.http.get(`${this.apiUrl}/validar-documento/${e}`).pipe(t(this.handleError))}validarCorreoExistente(e){return this.http.get(`${this.apiUrl}/validar-correo/${encodeURIComponent(e)}`).pipe(t(this.handleError))}obtenerTiposDocumento(){return this.http.get(`${this.apiUrl}/search-all-tipo-documento`).pipe(t(this.handleError))}obtenerGeneros(){return this.http.get(`${this.apiUrl}/search-all-sexo`).pipe(t(this.handleError))}obtenerEnfoquesDiferenciales(){return this.http.get(`${this.apiUrl}/search-all-enfoque-diferencial`).pipe(t(this.handleError))}buscarDepartamentosMunicipios(e){let r=new U;return e&&(r=r.set("query",e)),this.http.get(`${this.apiUrl}/search-all-departamento-municipio`,{params:r}).pipe(t(this.handleError))}handleError(e){let r="Ha ocurrido un error inesperado";if(e.error instanceof ErrorEvent)r=`Error: ${e.error.message}`;else switch(e.status){case 400:r="Datos inv\xE1lidos. Por favor, revise la informaci\xF3n ingresada.";break;case 401:r="No tiene autorizaci\xF3n para realizar esta acci\xF3n.";break;case 404:r="La informaci\xF3n solicitada no fue encontrada.";break;case 409:r="Ya existe un registro con estos datos.";break;case 500:r="Error interno del servidor. Intente m\xE1s tarde.";break;default:r=`Error ${e.status}: ${e.message}`}return console.error("Error en InformacionPersonalService:",e),E(()=>new Error(r))}static \u0275fac=function(r){return new(r||o)(S($))};static \u0275prov=j({token:o,factory:o.\u0275fac,providedIn:"root"})};var He=()=>{let o=n(m),e=n(u),r=n(h),w=n(C),c=o.session?.user.user_metadata.idPersona;if(!c)return!0;let b=!1,D=r.selectSignal(T)();return b=!!D&&D.id===c,b?!0:(r.dispatch(a.loadPersona({id:c})),e.obtenerInformacionPersonal(c).pipe(d({next:f=>r.dispatch(a.loadPersonaSuccess({persona:f})),error:f=>r.dispatch(a.loadPersonaFailure({error:f.message||"Error cargando persona"}))}),t(()=>(w.showError("No fue posible cargar la informaci\xF3n personal, por favor contacte al administrador."),o.signOut())),g(()=>!0)))};export{a,L as b,V as c,N as d,M as e,T as f,u as g,He as h};
