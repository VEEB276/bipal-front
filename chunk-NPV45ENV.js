import{m as p,o as a,t as D,u as $,v as l}from"./chunk-JBZPDIJX.js";import{C as t,Fc as P,Gc as E,Hc as g,ba as s,fa as b,ka as v,la as o,n as u,r as f}from"./chunk-7Z2KQZRE.js";var c=class n{constructor(r){this.http=r}apiUrl=`${$.hojaDeVidaApiUrl}/persona`;httpOptions={headers:new P({"Content-Type":"application/json"})};auth=o(l);store=o(p);obtenerInformacionPersonal(r){return this.http.get(`${this.apiUrl}/find-by-id-persona/${r}`).pipe(t(this.handleError))}obtenerTodasLasPersonas(){return this.http.get(this.apiUrl).pipe(t(this.handleError))}crearInformacionPersonal(r){return this.http.post(`${this.apiUrl}/create-persona`,r,this.httpOptions).pipe(s(e=>{this.auth.updatePersonaId(e.id).then(()=>this.auth.getSession()),this.store.dispatch(a.loadPersonaSuccess({persona:e}))}),t(this.handleError))}actualizarInformacionPersonal(r){return this.http.put(`${this.apiUrl}/actualizar-persona`,r,this.httpOptions).pipe(t(this.handleError))}eliminarInformacionPersonal(r){return this.http.delete(`${this.apiUrl}/${r}`).pipe(t(this.handleError))}buscarPorDocumento(r){return this.http.get(`${this.apiUrl}/find?numero-documento=${r}`).pipe(t(this.handleError))}validarDocumentoExistente(r){return this.http.get(`${this.apiUrl}/validar-documento/${r}`).pipe(t(this.handleError))}validarCorreoExistente(r){return this.http.get(`${this.apiUrl}/validar-correo/${encodeURIComponent(r)}`).pipe(t(this.handleError))}obtenerTiposDocumento(){return this.http.get(`${this.apiUrl}/search-all-tipo-documento`).pipe(t(this.handleError))}obtenerGeneros(){return this.http.get(`${this.apiUrl}/search-all-sexo`).pipe(t(this.handleError))}obtenerEnfoquesDiferenciales(){return this.http.get(`${this.apiUrl}/search-all-enfoque-diferencial`).pipe(t(this.handleError))}buscarDepartamentosMunicipios(r){let e=new E;return r&&(e=e.set("query",r)),this.http.get(`${this.apiUrl}/search-all-departamento-municipio`,{params:e}).pipe(t(this.handleError))}handleError(r){let e="Ha ocurrido un error inesperado";if(r.error instanceof ErrorEvent)e=`Error: ${r.error.message}`;else switch(r.status){case 400:e="Datos inv\xE1lidos. Por favor, revise la informaci\xF3n ingresada.";break;case 401:e="No tiene autorizaci\xF3n para realizar esta acci\xF3n.";break;case 404:e="La informaci\xF3n solicitada no fue encontrada.";break;case 409:e="Ya existe un registro con estos datos.";break;case 500:e="Error interno del servidor. Intente m\xE1s tarde.";break;default:e=`Error ${r.status}: ${r.message}`}return console.error("Error en InformacionPersonalService:",r),u(()=>new Error(e))}static \u0275fac=function(e){return new(e||n)(v(g))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var X=()=>{let n=o(l),r=o(c),e=o(p),i=n.session?.user.user_metadata.idPersona;if(!i)return!0;let d=!1,m=e.selectSignal(D)();return d=!!m&&m.id===i,d?!0:(e.dispatch(a.loadPersona({id:i})),r.obtenerInformacionPersonal(i).pipe(s({next:h=>e.dispatch(a.loadPersonaSuccess({persona:h})),error:h=>e.dispatch(a.loadPersonaFailure({error:h.message||"Error cargando persona"}))}),f(()=>!0)))};export{c as a,X as b};
